version: "3.9"

services:
  postgres:
    image: postgres:15
    restart: unless-stopped
    environment:
      POSTGRES_DB: nakama
      POSTGRES_USER: nakama
      POSTGRES_PASSWORD: local_dev_password
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  nakama:
    image: heroiclabs/nakama:3.16.0
    restart: unless-stopped
    entrypoint:
      - /bin/sh
      - -ec
      - |
        /nakama/nakama migrate up --database.address nakama:local_dev_password@postgres:5432/nakama
        exec /nakama/nakama --name nakama1 --database.address nakama:local_dev_password@postgres:5432/nakama --logger.level DEBUG --session.token_expiry_sec 7200 --runtime.http_key newduel-http-key
    depends_on:
      - postgres
    volumes:
      - ../nakama-runtime:/nakama/data/modules
    ports:
      - "7349:7349" # gRPC
      - "7350:7350" # HTTP
      - "7351:7351" # console
